Reasoning:

The given program is correct. Here's why:

1. The program correctly reads the input and initializes the necessary variables.
2. It calculates the sum of the friendship values (`sum_f`) for each test case.
3. It calculates the total number of possible pairs (`cn2`) using the formula `n * (n - 1) // 2`.
4. It calculates the expected value of the sum of friendship values for each excursion (`p`) using the formula `2 * k * cn2 * sum_f + m * k * (k - 1)`.
5. It calculates the denominator (`q`) using the formula `2 * cn2 ** 2`.
6. It calculates the greatest common divisor (`gcd`) of `p` and `q` using the `math.gcd` function.
7. It reduces the fraction `p/q` by dividing both `p` and `q` by `gcd`.
8. It calculates the modular inverse of `q` modulo `M` using the `pow` function with a negative exponent.
9. It multiplies `p` by the modular inverse of `q` and takes the result modulo `M` to get the final answer.

The program correctly handles the case where there are no pairs of friends (i.e., `m` is 0) by setting `sum_f` to 0 and `p` to 0.

The program also correctly handles the case where `k` is 1 by setting `p` to `2 * cn2 * sum_f`.

The program uses the correct modulus (`M`) and correctly reduces the fraction `p/q` to its simplest form.

Therefore, the program is correct.

Correctness: **True**