Correctness: **False**.

The program does not correctly calculate the expected value of the sum of friendship values of all k pairs chosen for the excursions. The issue lies in the calculation of the probability `p` and the modulus operation.

The correct calculation of `p` should be:

`p = 2 * k * cn2 * sum_f + m * k * (k - 1) * cn2`

However, the program is missing the `cn2` term in the second part of the calculation.

Additionally, the modulus operation is performed after calculating `p` and `q`, which can lead to incorrect results due to overflow. The modulus operation should be performed during the calculation of `p` and `q` to avoid overflow.

Here is an example where the program does not work correctly:

Input:

```
1
100 1 100
1 2 1
```

Expected output:

```
5050
```

Actual output:

```
500000004
```

The program's output is incorrect because it does not correctly calculate the probability `p` and performs the modulus operation after the calculation, leading to overflow.