Correctness: **False**.

The program does not correctly calculate the expected value of the sum of friendship values of all k pairs chosen for the excursions. The issue lies in the calculation of the probability `p` and the modulus operation.

In the given program, the probability `p` is calculated as `2 * k * cn2 * sum_f + m * k * (k - 1)`. However, this calculation is incorrect. The correct calculation should take into account the fact that the friendship value of a pair increases by 1 for each excursion, and the probability of choosing a pair of friends is `m / cn2`.

Moreover, the modulus operation `pow(q, -1, M)` is not correctly applied. The correct approach would be to calculate the modular inverse of `q` modulo `M` using the extended Euclidean algorithm or Fermat's little theorem.

A correct implementation would involve calculating the expected value of the sum of friendship values using the correct probability and modulus operations.