Reasoning: 

The given program is correct. It uses a series of queries to the input stream to compare elements of the permutation and determine the maximum and second-maximum values. The program first finds the maximum value in the permutation by comparing each element with the current maximum. Then, it finds the second-maximum value by comparing each element with the current second-maximum, excluding the maximum value found earlier. The program repeats this process for each test case until the input is exhausted.

The program uses a total of 3n queries, which is within the allowed limit. The queries are used to compare elements of the permutation and determine the maximum and second-maximum values. The program also handles the case where the maximum and second-maximum values are the same.

The program's output is in the correct format, with the maximum and second-maximum values printed in the format "! max second_max". The program also flushes the output stream after each query and after printing the final result, to ensure that the output is displayed promptly.

Correctness: **True**