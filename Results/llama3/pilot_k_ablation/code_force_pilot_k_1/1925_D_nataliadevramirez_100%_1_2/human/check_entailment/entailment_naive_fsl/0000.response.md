Correctness: **False**.

The program does not correctly calculate the expected value of the sum of friendship values of all k pairs chosen for the excursions. The issue lies in the calculation of the numerator and denominator of the expected value.

The numerator should be the sum of the products of the friendship values and the probabilities of choosing each pair, but the program calculates it as `p * k * k - p * k + 2 * k * C * S`, which is incorrect.

The denominator should be the total number of possible pairs, which is `C = n * (n - 1) // 2`, but the program calculates it as `2 * C * C`, which is also incorrect.

A correct implementation would involve calculating the expected value using the formula `E[X] = âˆ‘(x * P(x))`, where `x` is the friendship value and `P(x)` is the probability of choosing the pair with that friendship value.

Here's a corrected version of the program:
```
import math

def func():
    MOD = 1000000007
    T = int(input())
    for _ in range(T):
        (n, p, k) = map(int, input().split())
        S = 0
        pairs = []
        for i in range(p):
            a, b, f = map(int, input().split())
            pairs.append((f, 1))  # (friendship value, probability)
            S += f
        C = n * (n - 1) // 2
        expected_value = 0
        for i in range(k):
            for f, prob in pairs:
                expected_value += f * prob
            for f, prob in pairs:
                prob = (prob * (C - 1)) // C
                pairs.append((f + 1, prob))
        expected_value %= MOD
        print(expected_value)
```
This corrected program calculates the expected value by iterating over each pair and calculating the probability of choosing that pair, then updating the probability for the next iteration. The expected value is then calculated by summing the products of the friendship values and their probabilities.