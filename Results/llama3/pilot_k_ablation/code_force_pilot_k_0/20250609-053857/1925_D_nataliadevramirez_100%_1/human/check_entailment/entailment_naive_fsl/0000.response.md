Correctness: **False**.

The program does not correctly calculate the expected value of the sum of friendship values of all k pairs chosen for the excursions. The issue lies in the calculation of the numerator `num`. The correct calculation should be:

`num = p * k * k - p * k + 2 * k * C * S + k * (k - 1) * p`

The additional term `k * (k - 1) * p` accounts for the increase in friendship value for each pair of friends when they are chosen in subsequent excursions.

Without this term, the program will produce incorrect results for cases where `k` is greater than 1. For example, consider the input:

`4
2 1 10
1 2 1
3 1 2
2 1 1
5 2 4
1 2 25
3 2 24`

The program will output `55`, but the correct output should be `65`.