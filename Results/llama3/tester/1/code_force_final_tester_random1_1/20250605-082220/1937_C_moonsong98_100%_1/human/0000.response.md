Here are the comprehensive test cases for the given problem:

**1. Basic Test Cases**

# Test 1: Small Input
**Input**: 
```
2
4
```
**Output**: 
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the basic functionality of the program with a small input.

# Test 2: Medium Input
**Input**: 
```
3
10
```
**Output**: 
```
? 0 5 9 1
? 2 3 4 6
? 7 8 0 9
! 9 5
```
**Explanation**: This test case checks the program's behavior with a medium-sized input.

# Test 3: Large Input
**Input**: 
```
4
100
```
**Output**: 
```
? 0 50 99 1
? 20 30 40 60
? 70 80 0 99
! 99 50
```
**Explanation**: This test case checks the program's performance with a large input.

**2. Edge Test Cases**

# Test 4: Minimum Input
**Input**: 
```
2
```
**Output**: 
```
! 0 1
```
**Explanation**: This test case checks the program's behavior with the minimum possible input.

# Test 5: Maximum Input
**Input**: 
```
10000
```
**Output**: 
```
? 0 5000 9999 1
? 2000 3000 4000 6000
? 7000 8000 0 9999
! 9999 5000
```
**Explanation**: This test case checks the program's performance with the maximum possible input.

# Test 6: Duplicate Elements
**Input**: 
```
4
2 2 1 1
```
**Output**: 
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the program's behavior when there are duplicate elements in the input.

# Test 7: Already Sorted Input
**Input**: 
```
4
0 1 2 3
```
**Output**: 
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the program's behavior when the input is already sorted.

# Test 8: Reverse Sorted Input
**Input**: 
```
4
3 2 1 0
```
**Output**: 
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the program's behavior when the input is reverse sorted.

These test cases cover various scenarios, including small, medium, and large inputs, as well as edge cases like minimum and maximum inputs, duplicate elements, already sorted input, and reverse sorted input.