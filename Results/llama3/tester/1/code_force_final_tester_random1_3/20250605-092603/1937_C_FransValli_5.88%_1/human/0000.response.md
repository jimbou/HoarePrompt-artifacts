Here are the comprehensive test cases for the problem:

**1. Basic Test Cases**

# Test 1: Small input
**Input**:
```
2
4
```
**Output**:
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the basic functionality of the code with a small input.

# Test 2: Medium input
**Input**:
```
2
10
```
**Output**:
```
? 0 5 9 8
? 1 1 6 9
? 1 2 0 9
! 9 5
```
**Explanation**: This test case checks the code's behavior with a medium-sized input.

# Test 3: Large input
**Input**:
```
2
100
```
**Output**:
```
? 0 50 99 98
? 1 1 51 99
? 1 2 0 99
! 99 50
```
**Explanation**: This test case checks the code's performance with a large input.

**2. Edge Test Cases**

# Test 4: Minimum input
**Input**:
```
2
2
```
**Output**:
```
! 0 1
```
**Explanation**: This test case checks the code's behavior with the minimum possible input.

# Test 5: Maximum input
**Input**:
```
2
10000
```
**Output**:
```
? 0 5000 9999 9998
? 1 1 5001 9999
? 1 2 0 9999
! 9999 5000
```
**Explanation**: This test case checks the code's performance with the maximum possible input.

# Test 6: Duplicate elements
**Input**:
```
2
4
0 1 1 0
```
**Output**:
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the code's behavior when there are duplicate elements in the input.

# Test 7: All elements are the same
**Input**:
```
2
4
0 0 0 0
```
**Output**:
```
! 0 1
```
**Explanation**: This test case checks the code's behavior when all elements in the input are the same.

# Test 8: Negative numbers
**Input**:
```
2
4
-1 -2 -3 -4
```
**Output**:
```
? 0 2 3 1
? 1 1 2 3
? 1 2 0 3
! 3 2
```
**Explanation**: This test case checks the code's behavior when the input contains negative numbers.

Note that these test cases cover various scenarios, including small, medium, and large inputs, as well as edge cases like minimum and maximum inputs, duplicate elements, all elements being the same, and negative numbers.