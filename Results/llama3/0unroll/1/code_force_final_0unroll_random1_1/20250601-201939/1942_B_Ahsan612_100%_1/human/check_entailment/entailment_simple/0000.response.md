Reasoning:

The given program is correct. It correctly implements the logic to construct a valid permutation p that satisfies the given array a. The program uses a deque to efficiently update the mex value and construct the permutation p in reverse order.

The program first reads the input, which contains multiple test cases. Each test case contains two lines: the first line contains an integer n, and the second line contains n integers a_1, a_2, ..., a_n.

The program then initializes an empty list res to store the permutation p and a variable mex to store the minimum excluded value. The mex value is initially set to n.

The program then iterates over the input list ar in reverse order. For each element a_i in ar, it calculates the corresponding element p_i in the permutation p as mex - a_i. It then updates the mex value to be the minimum of the current mex and the difference between the current mex and the current element a_i.

Finally, the program prints the permutation p in the correct order by joining the elements of the res list with spaces.

The program correctly handles the case where the input list ar contains negative numbers, as it uses the mex value to ensure that the permutation p is valid.

Correctness: **True**