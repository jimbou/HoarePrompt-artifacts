This function reads a series of test cases from standard input, where each test case represents a permutation of integers. For each test case, it identifies the maximum and minimum elements in the permutation and prints their indices in the format '!', along with the index of the maximum element. The function performs a series of queries to determine the maximum and minimum elements, and it outputs the results for each test case.