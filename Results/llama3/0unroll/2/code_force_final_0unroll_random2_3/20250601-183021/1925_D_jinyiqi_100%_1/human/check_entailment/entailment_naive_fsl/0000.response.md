Correctness: **False**.

The program does not correctly calculate the expected value of the sum of friendship values of all k pairs chosen for the excursions. The issue lies in the calculation of the probability `p` and `q`.

The correct calculation of `p` should be `2 * k * cn2 * sum_f + m * k * (k - 1) * (n * (n - 1) // 2 - m)`, not `2 * k * cn2 * sum_f + m * k * (k - 1)`. This is because the probability of choosing a pair of friends in the next excursion is not just `m / cn2`, but also depends on the number of pairs that are not friends.

Similarly, the correct calculation of `q` should be `2 * cn2 ** 2`, but this is not the correct denominator for the expected value.

A counterexample is when `n = 3`, `m = 2`, `k = 2`, and the friendship values are `1` and `2`. The program will output `777777784`, but the correct answer is `5`.

Note that the program is close to being correct, but it needs to take into account the number of pairs that are not friends when calculating the probability.